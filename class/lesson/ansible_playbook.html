

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ansible Playbooks &mdash; my Cloudmesh Learning documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/my_theme.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../../about.html"/>
    <link rel="top" title="my Cloudmesh Learning documentation" href="../../index.html"/>
        <link rel="up" title="Lessons" href="../lessons.html"/>
        <link rel="next" title="Docker Basics on FutureSystems" href="docker.html"/>
        <link rel="prev" title="Ansible" href="ansible.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../index.html" class="icon icon-home"> my Cloudmesh
        

        
          
          <img src="../../_static/cm-logo-24.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources from the Internet</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Cloudmesh in Classes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bdossp_sp15/index.html"> Spring 2015 - Big Data Open Source Software Project (BUEX-V 594)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vc_sp15/index.html">Spring 2015 - Big Data Applications to Clouds and HPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i590.html">Fall 2014 - Big Data Applications and Analytics (<code class="docutils literal"><span class="pre">Info</span> <span class="pre">I590</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cm-mooc/index.html">VM for Big Data Applications and Analytics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../lessons.html">Lessons</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ansible.html">Ansible</a></li>
<li class="toctree-l3"><a class="reference internal" href="ansible.html#tutorial-ansible-basic-commands">Tutorial: Ansible Basic commands</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Ansible Playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="docker.html">Docker Basics on FutureSystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="docker_cloudmesh.html">Deploying Cloudmesh using Docker on FutureSystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html">FAQ (Under Preparation)</a></li>
<li class="toctree-l3"><a class="reference internal" href="git.html">Using Git and GitHub for collaboration</a></li>
<li class="toctree-l3"><a class="reference internal" href="google.html">Google</a></li>
<li class="toctree-l3"><a class="reference internal" href="hands_on_fg465.html">Getting Started with Hands-on Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipynb.html">Deploying IPython Notebook Cluster with Cloudmesh <code class="docutils literal"><span class="pre">launcher</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="list_of_dataset.html">List of Dataset (Under preparation)</a></li>
<li class="toctree-l3"><a class="reference internal" href="list_of_tech.html">List of Technologies (Under Preparation)</a></li>
<li class="toctree-l3"><a class="reference internal" href="lpbs.html">Local PBS Queuing System</a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html">Environment Modules (modules) on FutureSystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="openmpi.html">Deploying Open MPI Cluster with Cloudmesh <code class="docutils literal"><span class="pre">launcher</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="preservation.html">Best Practices for Preservation of IaaS and Data in FutureSystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="project_examples.html">Sample Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="projects.html">Final Project Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyton_matlab.html">Calling Python from matlab</a></li>
<li class="toctree-l3"><a class="reference internal" href="report.html">Report</a></li>
<li class="toctree-l3"><a class="reference internal" href="resource_use_restriction.html">Use of OpenStack Resources on FutureSystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="restructuredtext.html">Restructured Text</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rst.html">reStructuredText</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rst2.html">Sphinx Quick Reference Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="shell-access.html">Shell Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html"> (Video lectures) Spring 2015 - Big Data Open Source Software Project (BUEX-V 594)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/index.html">Possible Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounts/index.html">Cloud Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloudmesh/index.html">Cloudmesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parallel.html">Parallel Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iaas/index.html">IaaS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../paas/index.html">PaaS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc/index.html">HPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/index.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/index.html">DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ipython/index.html">IPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst.html">reStructuredText</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../management/index.html">Create Cloudmesh Development Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute to Cloudmesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archived.html">Archived</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">ToDos</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">my Cloudmesh</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          breadcrumbs

          <div role="main" class="document">
            
  <div class="section" id="ansible-playbooks">
<h1>Ansible Playbooks<a class="headerlink" href="#ansible-playbooks" title="Permalink to this headline">¶</a></h1>
<p>Ansible Playbooks are automated scripts written in YAML data format.  Instead
of using manual commands to setup multiple remote machines, you can utilize
Ansible Playbooks to configure your entire systems. YAML syntax is easy to read
and express the data structure of certain Ansible functions. You simply write
some tasks, for example, installing software, configuring default settings, and
starting the software, in a Ansible Playbook.  With a few examples in this
tutorial, you will understand how it works and how to write your own Playbooks.</p>
<blockquote>
<div>There are also several examples of using Ansible <a class="reference external" href="http://docs.ansible.com/playbooks.html">Playbooks</a> from the official site. It covers
from basic usage of Ansible Playbooks to advanced usage such as applying
patches and updates with different roles and groups.</div></blockquote>
<div class="section" id="tutorial-writing-ansible-playbook">
<h2>Tutorial: Writing Ansible Playbook<a class="headerlink" href="#tutorial-writing-ansible-playbook" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, we are going to write a basic playbook of Ansible software.
Keep in mind that <code class="docutils literal"><span class="pre">Ansible</span></code> is a main program and <code class="docutils literal"><span class="pre">playbook</span></code> is a template
that you would like to use. You may have several playbooks in your Ansible.</p>
<div class="section" id="first-playbook-for-mongodb-installation">
<h3>First playbook for MongoDB Installation<a class="headerlink" href="#first-playbook-for-mongodb-installation" title="Permalink to this headline">¶</a></h3>
<p>As a first example, we are going to write a playbook which installs MongoDB
server.  It includes the following tasks:</p>
<ul class="simple">
<li>Import the public key used by the package management system</li>
<li>Create a list file for MongoDB</li>
<li>Reload local package database</li>
<li>Install the MongoDB packages</li>
<li>Start MongoDB</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This tutorial is based on the manual installation of MongoDB from
the official site:
<a class="reference external" href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/*">http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/*</a></p>
<p class="last">We also assume that we install MongoDB on Ubuntu 14.04.</p>
</div>
</div>
<div class="section" id="enabling-root-ssh-access">
<h3>Enabling Root SSH Access<a class="headerlink" href="#enabling-root-ssh-access" title="Permalink to this headline">¶</a></h3>
<p>Some setups of managed nodes may not allow you to log in as root.  As
this may be problematic later, let us create a playbook to resolve
this. Create a <code class="docutils literal"><span class="pre">enable-root-access.yaml</span></code> file with the following contents:</p>
<div class="highlight-python"><div class="highlight"><pre>---
- hosts: ansible-test
  remote_user: ubuntu
  tasks:
    - name: Enable root login
      shell: sudo cp ~/.ssh/authorized_keys /root/.ssh/
</pre></div>
</div>
<p>Explanation:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">hosts</span></code> specifies the name of a group of machines in the inventory</li>
<li><code class="docutils literal"><span class="pre">remote_user</span></code> specifies the username on the managed nodes to log in as</li>
<li><code class="docutils literal"><span class="pre">tasks</span></code> is a list of tasks to accomplish having a <code class="docutils literal"><span class="pre">name</span></code> (a
description) and modules to execute. In this case we use the
<code class="docutils literal"><span class="pre">shell</span></code> module.</li>
</ul>
<p>We can run this playbook like so:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ansible-playbook -i inventory.txt -c ssh enable-root-access.yaml

PLAY [ansible-test] ***********************************************************

GATHERING FACTS ***************************************************************
ok: [10.23.2.105]
ok: [10.23.2.104]

TASK: [Enable root login] *****************************************************
changed: [10.23.2.104]
changed: [10.23.2.105]

PLAY RECAP ********************************************************************
10.23.2.104                : ok=2    changed=1    unreachable=0    failed=0
10.23.2.105                : ok=2    changed=1    unreachable=0    failed=0
</pre></div>
</div>
</div>
<div class="section" id="hosts-and-users">
<h3>Hosts and Users<a class="headerlink" href="#hosts-and-users" title="Permalink to this headline">¶</a></h3>
<p>First step is choosing hosts to install MongoDB and a user account to run
commands (tasks).  We start with the following lines in the example filename of
<code class="docutils literal"><span class="pre">mongodb.yaml</span></code></p>
<div class="highlight-python"><div class="highlight"><pre>---
- hosts: ansible-test
  remote_user: root
</pre></div>
</div>
<p>In a previous tutorial, we setup two machines with <code class="docutils literal"><span class="pre">ansible-test</span></code> group name. This
tutorial uses that two machines for MongoDB installation.  Also, we use
<code class="docutils literal"><span class="pre">root</span></code> account to complete Ansible tasks.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Indentation is important in YAML format. Do not ignore spaces start
with in each line.</p>
</div>
</div>
<div class="section" id="tasks">
<h3>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h3>
<p>A list of tasks contains commands or configurations to be executed on remote
machines in a sequential order.  Each task comes with a <code class="docutils literal"><span class="pre">name</span></code> and a
<code class="docutils literal"><span class="pre">module</span></code> to run your command or configuration.  You provide a description of
your task in <code class="docutils literal"><span class="pre">name</span></code> section and choose a <code class="docutils literal"><span class="pre">module</span></code> for your task.  There are
several modules that you can use, for example, <code class="docutils literal"><span class="pre">shell</span></code> module simply executes
a command without considering a return value.  You may use <code class="docutils literal"><span class="pre">apt</span></code> or <code class="docutils literal"><span class="pre">yum</span></code>
module which is one of the packaging modules to install software. You can find
an entire list of modules here:
<a class="reference external" href="http://docs.ansible.com/list_of_all_modules.html">http://docs.ansible.com/list_of_all_modules.html</a></p>
</div>
<div class="section" id="module-apt-key-add-repository-keys">
<h3>Module <code class="docutils literal"><span class="pre">apt_key</span></code>: add repository keys<a class="headerlink" href="#module-apt-key-add-repository-keys" title="Permalink to this headline">¶</a></h3>
<p>We need to import the MongoDB public GPG Key. This is going to be a first task
in our playbook.</p>
<div class="highlight-python"><div class="highlight"><pre>tasks:
  - name: Import the public key used by the package management system
    apt_key: keyserver=hkp://keyserver.ubuntu.com:80 id=7F0CEB10 state=present
</pre></div>
</div>
</div>
<div class="section" id="module-apt-repository-add-repositories">
<h3>Module <code class="docutils literal"><span class="pre">apt_repository</span></code>: add repositories<a class="headerlink" href="#module-apt-repository-add-repositories" title="Permalink to this headline">¶</a></h3>
<p>Next add the MongoDB repository to apt:</p>
<div class="highlight-python"><div class="highlight"><pre>- name: Add MongoDB repository
  apt_repository: repo=&#39;deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen&#39; state=present
</pre></div>
</div>
</div>
<div class="section" id="module-apt-install-packages">
<h3>Module <code class="docutils literal"><span class="pre">apt</span></code>: install packages<a class="headerlink" href="#module-apt-install-packages" title="Permalink to this headline">¶</a></h3>
<p>We use <code class="docutils literal"><span class="pre">apt</span></code> module to install <code class="docutils literal"><span class="pre">mongodb-org</span></code> package.
<code class="docutils literal"><span class="pre">notify</span></code> action is added to start <code class="docutils literal"><span class="pre">mongod</span></code> after the completion of this task.
Use the <code class="docutils literal"><span class="pre">update_cache=yes</span></code> option to reload the local package database.</p>
<dl class="docutils">
<dt>::</dt>
<dd><ul class="first last simple">
<li>name: install mongodb
apt: pkg=mongodb-org state=latest update_cache=yes
notify:
- start mongodb</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="module-service-manage-services">
<h3>Module <code class="docutils literal"><span class="pre">service</span></code>: manage services<a class="headerlink" href="#module-service-manage-services" title="Permalink to this headline">¶</a></h3>
<p>We use <code class="docutils literal"><span class="pre">handlers</span></code> here to start or restart services. It is similar to <code class="docutils literal"><span class="pre">tasks</span></code> but will run only once.</p>
<div class="highlight-python"><div class="highlight"><pre>handlers:
  - name: start mongodb
    service: name=mongod state=started
</pre></div>
</div>
</div>
<div class="section" id="the-full-playbook">
<h3>The Full Playbook<a class="headerlink" href="#the-full-playbook" title="Permalink to this headline">¶</a></h3>
<p>Our first playbook looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>---
- hosts: ansible-test
  remote_user: root
  tasks:
  - name: Import the public key used by the package management system
    apt_key: keyserver=hkp://keyserver.ubuntu.com:80 id=7F0CEB10 state=present
  - name: Add MongoDB repository
    apt_repository: repo=&#39;deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen&#39; state=present
  - name: install mongodb
    apt: pkg=mongodb-org state=latest update_cache=yes
    notify:
    - start mongodb
  handlers:
    - name: start mongodb
      service: name=mongod state=started
</pre></div>
</div>
</div>
<div class="section" id="running-a-playbook">
<h3>Running a Playbook<a class="headerlink" href="#running-a-playbook" title="Permalink to this headline">¶</a></h3>
<p>We use <code class="docutils literal"><span class="pre">ansible-playbook</span></code> command to run our playbook:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ansible-playbook -i inventory.txt -c ssh mongodb.yaml

PLAY [ansible-test] ***********************************************************

GATHERING FACTS ***************************************************************
ok: [10.23.2.104]
ok: [10.23.2.105]

TASK: [Import the public key used by the package management system] ***********
changed: [10.23.2.104]
changed: [10.23.2.105]

TASK: [Add MongoDB repository] ************************************************
changed: [10.23.2.104]
changed: [10.23.2.105]

TASK: [install mongodb] *******************************************************
changed: [10.23.2.104]
changed: [10.23.2.105]

NOTIFIED: [start mongodb] *****************************************************
ok: [10.23.2.105]
ok: [10.23.2.104]

PLAY RECAP ********************************************************************
10.23.2.104                : ok=5    changed=3    unreachable=0    failed=0
10.23.2.105                : ok=5    changed=3    unreachable=0    failed=0
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you rerun the playbook, you should see that nothing changed:</p>
<div class="last highlight-python"><div class="highlight"><pre>$ ansible-playbook -i inventory.txt -c ssh mongodb.yaml

PLAY [ansible-test] ***********************************************************

GATHERING FACTS ***************************************************************
ok: [10.23.2.105]
ok: [10.23.2.104]

TASK: [Import the public key used by the package management system] ***********
ok: [10.23.2.104]
ok: [10.23.2.105]

TASK: [Add MongoDB repository] ************************************************
ok: [10.23.2.104]
ok: [10.23.2.105]

TASK: [install mongodb] *******************************************************
ok: [10.23.2.105]
ok: [10.23.2.104]

PLAY RECAP ********************************************************************
10.23.2.104                : ok=4    changed=0    unreachable=0    failed=0
10.23.2.105                : ok=4    changed=0    unreachable=0    failed=0
</pre></div>
</div>
</div>
</div>
<div class="section" id="sanity-check-test-mongodb">
<h3>Sanity Check: Test MongoDB<a class="headerlink" href="#sanity-check-test-mongodb" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s try to run &#8216;mongo&#8217; to enter mongodb shell.</p>
<div class="highlight-python"><div class="highlight"><pre>$ ssh ubuntu@$IP
$ mongo
MongoDB shell version: 2.6.9
connecting to: test
Welcome to the MongoDB shell.
For interactive help, type &quot;help&quot;.
For more comprehensive documentation, see
        http://docs.mongodb.org/
Questions? Try the support group
        http://groups.google.com/group/mongodb-user
&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="terms">
<h2>Terms<a class="headerlink" href="#terms" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Module: Ansible library to run or manage services, packages, files or commands.</li>
<li>Handler: A task for notifier.</li>
<li>Task: Ansible job to run a command, check files, or update configurations.</li>
<li>Playbook: a list of tasks for Ansible nodes. YAML format used.</li>
<li>YAML: Human readable generic data serialization.</li>
</ul>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<p>The main tutorial from Ansible is here: <a class="reference external" href="http://docs.ansible.com/playbooks_intro.html">http://docs.ansible.com/playbooks_intro.html</a></p>
<p>You can also find an index of the ansible modules here: <a class="reference external" href="http://docs.ansible.com/modules_by_category.html">http://docs.ansible.com/modules_by_category.html</a></p>
</div>
</div>


          </div>
          fotter
        </div>
      </div>

    </section>

  </div>
  fotter

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'Learning',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>