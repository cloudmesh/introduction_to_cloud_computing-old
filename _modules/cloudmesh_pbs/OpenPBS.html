

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cloudmesh_pbs.OpenPBS &mdash; my Cloudmesh Learning documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/my_theme.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../../about.html"/>
    <link rel="top" title="my Cloudmesh Learning documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../index.html" class="icon icon-home"> my Cloudmesh
        

        
          
          <img src="../../_static/cm-logo-24.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources from the Internet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class/index.html">Cloudmesh in Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/index.html">Possible Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounts/index.html">Cloud Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloudmesh/index.html">Cloudmesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parallel.html">Parallel Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iaas/index.html">IaaS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../paas/index.html">PaaS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc/index.html">HPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/index.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/index.html">DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ipython/index.html">IPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst.html">reStructuredText</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../management/index.html">Create Cloudmesh Development Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute to Cloudmesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archived.html">Archived</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">ToDos</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">my Cloudmesh</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>cloudmesh_pbs.OpenPBS</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for cloudmesh_pbs.OpenPBS</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">xml.dom</span> <span class="kn">import</span> <span class="n">minidom</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">cloudmesh_base.Shell</span> <span class="kn">import</span> <span class="n">Shell</span>
<span class="kn">from</span> <span class="nn">cloudmesh_base.ConfigDict</span> <span class="kn">import</span> <span class="n">ConfigDict</span>
<span class="kn">from</span> <span class="nn">cloudmesh_base.util</span> <span class="kn">import</span> <span class="n">banner</span>
<span class="kn">from</span> <span class="nn">cloudmesh_base.util</span> <span class="kn">import</span> <span class="n">path_expand</span>
<span class="kn">from</span> <span class="nn">cloudmesh_base.locations</span> <span class="kn">import</span> <span class="n">config_file</span>
<span class="kn">from</span> <span class="nn">cloudmesh_base.xshellutil</span> <span class="kn">import</span> <span class="n">xcopy</span><span class="p">,</span> <span class="n">xmkdir</span>
<span class="kn">from</span> <span class="nn">cloudmesh_base.ssh_config</span> <span class="kn">import</span> <span class="n">ssh_config</span>

<span class="kn">from</span> <span class="nn">cloudmesh_base.logger</span> <span class="kn">import</span> <span class="n">LOGGER</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">LOGGER</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>

<div class="viewcode-block" id="OpenPBS"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS">[docs]</a><span class="k">class</span> <span class="nc">OpenPBS</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="c"># #################################################################</span>
    <span class="c"># INITIALIZATION</span>
    <span class="c"># #################################################################</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deploy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yaml_filename</span><span class="o">=</span><span class="s">&quot;/cloudmesh_pbs.yaml&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an object instance of communication with pbs batch queues</span>
<span class="sd">        running on multiple hosts.</span>

<span class="sd">        It also is used to create some configuration parameters if deploy</span>
<span class="sd">        is set to True.</span>

<span class="sd">        it creates in the CLOUDMESH deploy directory the directory pbs and puts</span>
<span class="sd">        the dababse file pbs.db and the file that is used to store the current</span>
<span class="sd">        job number. The job number is shared among all resources and supposed</span>
<span class="sd">        to be unique.</span>


<span class="sd">        :param deploy: If True, creates the configuration files</span>
<span class="sd">        :param yaml_filename: The cloudmesh pbs yaml file. Defaults to</span>
<span class="sd">                              cloudmesh_pbs.yaml</span>
<span class="sd">        :return: an object instance of OpenPBS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_filename</span> <span class="o">=</span> <span class="n">config_file</span><span class="p">(</span><span class="n">yaml_filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pbs_dir</span> <span class="o">=</span> <span class="n">config_file</span><span class="p">(</span><span class="s">&quot;/pbs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_file</span> <span class="o">=</span> <span class="n">config_file</span><span class="p">(</span><span class="s">&quot;/pbs/id.txt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_file</span> <span class="o">=</span> <span class="n">config_file</span><span class="p">(</span><span class="s">&quot;/pbs/pbs.db&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">deploy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deploy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pbs_nodes_data</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="OpenPBS.info"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints some elementary information about the configuration of the</span>
<span class="sd">        OpenPBS instance.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;{:&gt;20} = {:}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Config Dir&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbs_dir</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;{:&gt;20} = {:}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Job ID file&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_file</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;{:&gt;20} = {:}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Db file&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_file</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="OpenPBS.load"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the cloudmesh pbs yaml file.</span>

<span class="sd">        :param yaml_filename: The filename of the yaml file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;PBS yaml filename: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_filename</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yaml_filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">yaml_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaml_filename</span> <span class="o">=</span> <span class="n">config_file</span><span class="p">(</span><span class="n">yaml_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span> <span class="o">=</span> <span class="n">ssh_config</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="OpenPBS.deploy"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.deploy">[docs]</a>    <span class="k">def</span> <span class="nf">deploy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copies the yaml file from etc in the distribution to the .cloudmesh</span>
<span class="sd">        directory. If the file exits it will not be copied and a warning is</span>
<span class="sd">        thrown. If the file is the same as in etc no warning is thrown.</span>

<span class="sd">        :param force: Forgot what this does, please document.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># setup ~/.cloudmesh/pbs</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbs_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbs_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbs_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_load_jobid</span><span class="p">()</span>

        <span class="n">xcopy</span><span class="p">(</span><span class="s">&quot;../etc/&quot;</span><span class="p">,</span> <span class="n">config_file</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="s">&quot;*.yaml&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>

    <span class="c"># #################################################################</span>
    <span class="c"># JOB ID COUNTER</span>
    <span class="c"># #################################################################</span>
</div>
    <span class="k">def</span> <span class="nf">_load_jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        internal method that loads the job id from the job id file.</span>

<span class="sd">        :return: the string of the job id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_file</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="nf">_write_jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal method that overwrites the job id to the specified id.</span>

<span class="sd">        :param id:  the job id</span>
<span class="sd">        :return: the string of the id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;CCC:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_file</span><span class="p">):</span>
            <span class="nb">open</span><span class="p">(</span><span class="s">&#39;file&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_file</span><span class="p">,</span> <span class="s">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
            <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The job id</span>
<span class="sd">        :return: The string of the job id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_jobid</span><span class="p">()</span>

    <span class="nd">@jobid.setter</span>
    <span class="k">def</span> <span class="nf">jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sets the job id to the given value</span>
<span class="sd">        :param value: The value of the jobid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_jobid</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="OpenPBS.jobid_incr"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.jobid_incr">[docs]</a>    <span class="k">def</span> <span class="nf">jobid_incr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        increments the job id by 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span> <span class="o">=</span> <span class="nb">id</span>


    <span class="c"># ###################</span>
    <span class="c"># GET DATA</span>
    <span class="c"># ###################</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the json object of the dict as string</span>
<span class="sd">        NOTE: should probably use json.dumps</span>
<span class="sd">        :return: the string representation of teh job data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<div class="viewcode-block" id="OpenPBS.servers"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.servers">[docs]</a>    <span class="k">def</span> <span class="nf">servers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of the servers as defined in the .ssh/config file as dict</span>
<span class="sd">        :return: the dict representing the servers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&quot;cloudmesh&quot;</span><span class="p">][</span><span class="s">&quot;pbs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="OpenPBS.queues"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.queues">[docs]</a>    <span class="k">def</span> <span class="nf">queues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List the queues dict of the given server</span>
<span class="sd">        :param server:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">pbs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&quot;cloudmesh&quot;</span><span class="p">][</span><span class="s">&quot;pbs&quot;</span><span class="p">][</span><span class="n">server</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&quot;queues&quot;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">server</span><span class="p">[</span><span class="s">&quot;queues&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>


    <span class="c">#</span>
    <span class="c"># QSTAT</span>
    <span class="c">#</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="OpenPBS.qstat_xml_to_dict"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.qstat_xml_to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">qstat_xml_to_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">xmldata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal method that converst a qsta xml representation to a dict.</span>
<span class="sd">        :param xmldata: The xml data from qstat -x</span>
<span class="sd">        :return: a dict representation of the data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xmldoc</span> <span class="o">=</span> <span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">xmldata</span><span class="p">)</span>

            <span class="n">itemlist</span> <span class="o">=</span> <span class="n">xmldoc</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&#39;Job&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemlist</span><span class="p">:</span>
                <span class="n">job</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">childNodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">childNodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">job</span><span class="p">[</span><span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">job</span><span class="p">[</span><span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">subchild</span> <span class="ow">in</span> <span class="n">attribute</span><span class="o">.</span><span class="n">childNodes</span><span class="p">:</span>
                            <span class="n">job</span><span class="p">[</span><span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span><span class="p">][</span>
                                <span class="n">subchild</span><span class="o">.</span><span class="n">nodeName</span><span class="p">]</span> <span class="o">=</span> <span class="n">subchild</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span>
                    <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Job_Owner&#39;</span><span class="p">]:</span>
                        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;@&#39;</span><span class="p">)</span>
                        <span class="n">job</span><span class="p">[</span><span class="s">u&#39;cm_user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                        <span class="n">job</span><span class="p">[</span><span class="s">u&#39;cm_host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span>

                <span class="n">info</span><span class="p">[</span><span class="n">job</span><span class="p">[</span><span class="s">&#39;Job_Id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">job</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xmldoc</span> <span class="o">=</span> <span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">xmldata</span><span class="p">)</span>

            <span class="n">itemlist</span> <span class="o">=</span> <span class="n">xmldoc</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&#39;Job&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemlist</span><span class="p">:</span>
                <span class="n">job</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">childNodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">childNodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">job</span><span class="p">[</span><span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">job</span><span class="p">[</span><span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">subchild</span> <span class="ow">in</span> <span class="n">attribute</span><span class="o">.</span><span class="n">childNodes</span><span class="p">:</span>
                            <span class="n">job</span><span class="p">[</span><span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span><span class="p">][</span>
                                <span class="n">subchild</span><span class="o">.</span><span class="n">nodeName</span><span class="p">]</span> <span class="o">=</span> <span class="n">subchild</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span>
                    <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Job_Owner&#39;</span><span class="p">]:</span>
                        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="n">attribute</span><span class="o">.</span><span class="n">nodeName</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;@&#39;</span><span class="p">)</span>
                        <span class="n">job</span><span class="p">[</span><span class="s">u&#39;cm_user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                        <span class="n">job</span><span class="p">[</span><span class="s">u&#39;cm_host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span>

                <span class="n">info</span><span class="p">[</span><span class="n">job</span><span class="p">[</span><span class="s">&#39;Job_Id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">job</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">info</span>
</div>
<div class="viewcode-block" id="OpenPBS.qstat"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.qstat">[docs]</a>    <span class="k">def</span> <span class="nf">qstat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;dict&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        executes the qstat command on a particular host and returns</span>
<span class="sd">        the information as dict.</span>

<span class="sd">        :param host: The host as specified in ~/.ssh/config</span>
<span class="sd">        :param user:  If True, only retirns information for the user</span>
<span class="sd">                      If False, all jobs for all users are returned</span>
<span class="sd">        :param format:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        <span class="n">manager_host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        <span class="n">xml_data</span> <span class="o">=</span> <span class="n">Shell</span><span class="o">.</span><span class="n">ssh</span><span class="p">(</span><span class="n">manager_host</span><span class="p">,</span> <span class="s">&quot;qstat&quot;</span><span class="p">,</span> <span class="s">&quot;-x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;dict&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">OpenPBS</span><span class="o">.</span><span class="n">qstat_xml_to_dict</span><span class="p">(</span><span class="n">xml_data</span><span class="p">)</span>
            <span class="n">selected_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">jobid</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">cm_host</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jobid</span><span class="p">][</span><span class="s">&#39;Job_Owner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;@&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
                    <span class="n">selected_data</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">jobid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">jobid</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="n">owner</span> <span class="o">==</span> <span class="n">username</span><span class="p">:</span>
                    <span class="n">selected_data</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">jobid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">jobid</span><span class="p">)]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">selected_data</span>
            <span class="k">for</span> <span class="n">jobid</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">jobid</span><span class="p">)][</span><span class="s">u&quot;cm_jobid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobid</span>
                <span class="k">if</span> <span class="s">&quot;Variable_list&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">jobid</span><span class="p">)]:</span>
                    <span class="n">data</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">jobid</span><span class="p">)][</span><span class="s">u&quot;cm_Variable_list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_list</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">jobid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&quot;xml&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;WARNING: &quot;</span>
                      <span class="s">&quot;restrictiong xml data for a user not supported.&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">xml_data</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OpenPBS.username"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.username">[docs]</a>    <span class="k">def</span> <span class="nf">username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The username of the host as specified in ~/.ssh/conf</span>
<span class="sd">        :param host: The name of the host</span>
<span class="sd">        :return: The username</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span><span class="o">.</span><span class="n">username</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OpenPBS.manager"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.manager">[docs]</a>    <span class="k">def</span> <span class="nf">manager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In some cases a queue of another machine is hosted through a</span>
<span class="sd">        management node different from that machine. The manager command</span>
<span class="sd">        allows us to specify on which machine the qstat command is issued.</span>

<span class="sd">        :param host: The name of the host</span>
<span class="sd">        :return: The name of the management host</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;cloudmesh&quot;</span><span class="p">,</span> <span class="s">&quot;pbs&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="s">&quot;manager&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="s">&quot;WARNING: Manager not defined for&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
            <span class="k">print</span> <span class="p">(</span><span class="s">&quot;         Using the host&quot;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">host</span>
        <span class="k">return</span> <span class="n">m</span>
</div>
<div class="viewcode-block" id="OpenPBS.database_filename"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.database_filename">[docs]</a>    <span class="k">def</span> <span class="nf">database_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the database file</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">path_expand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;cloudmesh&quot;</span><span class="p">,</span> <span class="s">&quot;pbsdatabase&quot;</span><span class="p">,</span> <span class="s">&quot;filename&quot;</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">_write_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to write a pbs script to a file</span>
<span class="sd">        :param script: content of the script</span>
<span class="sd">        :param filename: filename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
            <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">script</span><span class="p">)</span>

<div class="viewcode-block" id="OpenPBS.db_jobstatus"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.db_jobstatus">[docs]</a>    <span class="k">def</span> <span class="nf">db_jobstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;dict&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method is not yet implemented&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span>
</div>
<div class="viewcode-block" id="OpenPBS.jobstatus"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.jobstatus">[docs]</a>    <span class="k">def</span> <span class="nf">jobstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;dict&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The status of a specific job</span>

<span class="sd">        :param host: The host on which the job is running</span>
<span class="sd">        :param jobid: The jobid as specified by the queing system</span>
<span class="sd">        :param kind: The output can be returned as dict, xml, and yaml</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">manager_host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        <span class="n">qstat_xml_data</span> <span class="o">=</span> <span class="n">Shell</span><span class="o">.</span><span class="n">ssh</span><span class="p">(</span><span class="n">manager_host</span><span class="p">,</span> <span class="s">&quot;qstat&quot;</span><span class="p">,</span> <span class="s">&quot;-x&quot;</span><span class="p">,</span> <span class="n">jobid</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;xml&#39;</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">qstat_xml_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qstat_xml_to_dict</span><span class="p">(</span><span class="n">qstat_xml_data</span><span class="p">)</span>
            <span class="n">r</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">jobid</span><span class="p">)][</span><span class="s">u&quot;cm_jobid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span>
            <span class="n">r</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">jobid</span><span class="p">)][</span><span class="s">&quot;cm_Variable_list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_list</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;yaml&#39;</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="OpenPBS.list"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to lists the information in the data dict</span>
<span class="sd">        :param data: The data directory</span>
<span class="sd">        :param attributes: the attribute to return</span>
<span class="sd">        :return: the content found for he specified attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">jobid</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">content</span><span class="p">[</span><span class="n">jobid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">content</span><span class="p">[</span><span class="n">jobid</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jobid</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">content</span><span class="p">[</span><span class="n">jobid</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;None&quot;</span>
        <span class="k">return</span> <span class="n">content</span>
</div>
<div class="viewcode-block" id="OpenPBS.qsub"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.qsub">[docs]</a>    <span class="k">def</span> <span class="nf">qsub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&quot;dict&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the qsub command on a given host.</span>
<span class="sd">        NOTE this method may not yet be fully implemented</span>

<span class="sd">        :param name: name of the script</span>
<span class="sd">        :param host: host on which the script is to be run</span>
<span class="sd">        :param script: The name of the script</span>
<span class="sd">        :param template: The script is wrapped into a template</span>
<span class="sd">        :param kind: The return is passed as dict, yaml, xml</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobid_incr</span><span class="p">()</span>
        <span class="n">jobscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>

        <span class="c"># copy the script to the remote host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_to_file</span><span class="p">(</span><span class="n">jobscript</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c"># copy script to remote host</span>

        <span class="n">remote_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;cloudmesh&quot;</span><span class="p">,</span> <span class="s">&quot;pbs&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="s">&quot;scripts&quot;</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="n">remote_path</span><span class="p">)</span>
        <span class="n">xmkdir</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">)</span>

        <span class="n">manager_host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>

        <span class="c"># call qsub on the remot host</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">Shell</span><span class="o">.</span><span class="n">scp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">manager_host</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">remote_path</span><span class="p">)</span>
        <span class="n">jobid</span> <span class="o">=</span> <span class="n">Shell</span><span class="o">.</span><span class="n">ssh</span><span class="p">(</span><span class="n">manager_host</span><span class="p">,</span> <span class="s">&quot;qsub {0}/{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">remote_path</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobstatus</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OpenPBS.getid"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.getid">[docs]</a>    <span class="k">def</span> <span class="nf">getid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">key</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="OpenPBS.variable_list"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.variable_list">[docs]</a>    <span class="k">def</span> <span class="nf">variable_list</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to list the variables of a qstat job</span>
<span class="sd">        which is &#39;Variable_List&#39;</span>

<span class="sd">        :param data: The input data value</span>
<span class="sd">        :param id: The id of the job</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="n">var_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s">&#39;Variable_List&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">var_list</span><span class="p">:</span>
            <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">d</span>
</div>
<div class="viewcode-block" id="OpenPBS.create_script"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.create_script">[docs]</a>    <span class="k">def</span> <span class="nf">create_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># BUG</span>
        <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">template_script</span> <span class="o">=</span> <span class="n">script</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;script&#39;</span><span class="p">:</span> <span class="n">script</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="OpenPBS.read_script"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.read_script">[docs]</a>    <span class="k">def</span> <span class="nf">read_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&#39;localhost&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">host</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;localhost&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">user</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TODO: copy file from remote host</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: not implemented&quot;</span><span class="p">)</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">content</span>
</div>
<div class="viewcode-block" id="OpenPBS.anodes"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.anodes">[docs]</a>    <span class="k">def</span> <span class="nf">anodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">pass</span>

</div>
<div class="viewcode-block" id="OpenPBS.nodes"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.nodes">[docs]</a>    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the information from the command pbsnodes in a dict.</span>

<span class="sd">        :param host: the name of the host as specified in the .ssh/config file</span>
<span class="sd">        :param refresh: if False, reads returns a cached value</span>
<span class="sd">                        if True, issues a new command and refreshes the cach</span>
<span class="sd">        :return: information of the pbsnodes command in a dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">manager_host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbs_nodes_data</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Shell</span><span class="o">.</span><span class="n">ssh</span><span class="p">(</span><span class="n">manager_host</span><span class="p">,</span> <span class="s">&quot;pbsnodes&quot;</span><span class="p">,</span> <span class="s">&quot;-a&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s">&quot;can not execute pbs nodes on host {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">manager_host</span><span class="p">))</span>
            <span class="n">pbsinfo</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">pbs_data</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">pbs_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pbs_data</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">pbs_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">pbsinfo</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
                    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">pbs_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; = &quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s">&#39;status&#39;</span><span class="p">:</span>
                                <span class="n">status_elements</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
                                <span class="n">pbsinfo</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">status_elements</span><span class="p">:</span>
                                    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">)</span>
                                    <span class="n">pbsinfo</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">attribute</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                            <span class="k">elif</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s">&#39;jobs&#39;</span><span class="p">:</span>
                                <span class="n">pbsinfo</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s">&#39;note&#39;</span> <span class="ow">and</span> <span class="p">(</span>
                                        <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;{&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;[&quot;</span><span class="p">)):</span>
                                <span class="n">pbsinfo</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">pbsinfo</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbs_nodes_data</span> <span class="o">=</span> <span class="n">pbsinfo</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbs_nodes_data</span>
</div>
<div class="viewcode-block" id="OpenPBS.nodes_sum"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.nodes_sum">[docs]</a>    <span class="k">def</span> <span class="nf">nodes_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_distribution</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">distribution</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">distribution</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">return</span> <span class="nb">sum</span>
</div>
<div class="viewcode-block" id="OpenPBS.nodes_distribution"><a class="viewcode-back" href="../../modules/pbs/cloudmesh_pbs.html#cloudmesh_pbs.OpenPBS.OpenPBS.nodes_distribution">[docs]</a>    <span class="k">def</span> <span class="nf">nodes_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;prints the distribution of services&quot;&quot;&quot;</span>

        <span class="n">manager_host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">pbsnodes_data</span><span class="p">(</span><span class="n">manager_host</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">Shell</span><span class="o">.</span><span class="n">ssh</span><span class="p">(</span><span class="n">manager_host</span><span class="p">,</span> <span class="s">&quot;pbsnodes&quot;</span><span class="p">,</span> <span class="s">&quot;-l&quot;</span><span class="p">,</span> <span class="s">&quot;-n&quot;</span><span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">result</span>


        <span class="n">empty</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pbsnodes_data</span><span class="p">(</span><span class="n">manager_host</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span>

        <span class="c"># Fill missing values</span>

        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;unkown&quot;</span><span class="p">,</span> <span class="s">&quot;unkown&quot;</span><span class="p">,</span> <span class="s">&quot;unkown&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>

        <span class="c"># just taking column 2</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span>

        <span class="c"># print &quot;GFKHFJH &quot;, x</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c"># print &quot;COUNT&quot;,</span>

        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c"># TODO: when hosts are bravo, echo, delta, the manager need sto be used to ssh</span>

    <span class="n">host</span> <span class="o">=</span> <span class="s">&quot;india&quot;</span>

    <span class="n">pbs</span> <span class="o">=</span> <span class="n">OpenPBS</span><span class="p">(</span><span class="n">deploy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>




    <span class="n">manager</span> <span class="o">=</span> <span class="n">pbs</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>

    <span class="n">pprint</span> <span class="p">(</span><span class="n">pbs</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">host</span><span class="p">))</span>

    <span class="n">pprint</span> <span class="p">(</span><span class="n">pbs</span><span class="o">.</span><span class="n">nodes_distribution</span><span class="p">(</span><span class="n">host</span><span class="p">))</span>

    <span class="n">pprint</span> <span class="p">(</span><span class="n">pbs</span><span class="o">.</span><span class="n">nodes_sum</span><span class="p">(</span><span class="n">host</span><span class="p">))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="n">pbs</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>


    <span class="n">manager</span> <span class="o">=</span> <span class="n">pbs</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
    <span class="n">xmkdir</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="s">&quot;~/scripts/test&quot;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">pbs</span><span class="p">)</span>

    <span class="n">script_template</span> <span class="o">=</span> <span class="n">pbs</span><span class="o">.</span><span class="n">read_script</span><span class="p">(</span><span class="s">&quot;etc/job.pbs&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">script_template</span><span class="p">)</span>

    <span class="n">script</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    uname -a</span>
<span class="s">    &quot;&quot;&quot;</span>

    <span class="n">jobname</span> <span class="o">=</span> <span class="s">&quot;job-&quot;</span> <span class="o">+</span> <span class="n">pbs</span><span class="o">.</span><span class="n">jobid</span>
    <span class="n">job_script</span> <span class="o">=</span> <span class="n">pbs</span><span class="o">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">jobname</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">script_template</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">job_script</span><span class="p">)</span>

    <span class="c"># print(pbs.jobid)</span>
    <span class="c"># pbs.jobid_set(100)</span>
    <span class="c"># print(pbs.jobid)</span>
    <span class="n">pbs</span><span class="o">.</span><span class="n">jobid_incr</span><span class="p">()</span>

    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;qsub&#39;</span><span class="p">)</span>

    <span class="n">jobname</span> <span class="o">=</span> <span class="s">&quot;job-&quot;</span> <span class="o">+</span> <span class="n">pbs</span><span class="o">.</span><span class="n">jobid</span> <span class="o">+</span> <span class="s">&quot;.pbs&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pbs</span><span class="o">.</span><span class="n">qsub</span><span class="p">(</span><span class="n">jobname</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="s">&#39;echo &quot;Hello&quot;&#39;</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="n">script_template</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;variable list&#39;</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">OpenPBS</span><span class="o">.</span><span class="n">variable_list</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

    <span class="n">banner</span><span class="p">(</span><span class="s">&#39;status&#39;</span><span class="p">)</span>
    <span class="n">jobid</span> <span class="o">=</span> <span class="n">pbs</span><span class="o">.</span><span class="n">getid</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pbs</span><span class="o">.</span><span class="n">jobstatus</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">jobid</span><span class="p">)</span>

    <span class="n">pprint</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">pbs</span><span class="o">.</span><span class="n">qstat</span><span class="p">(</span><span class="s">&quot;india&quot;</span><span class="p">)</span>

    <span class="n">banner</span><span class="p">(</span><span class="s">&quot;RESULT&quot;</span><span class="p">)</span>

    <span class="n">pprint</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>




    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    #os.system (&quot;cat &quot; + jobname)</span>
<span class="sd">    print()</span>
<span class="sd">    </span>
<span class="sd">    db = pbs_shelve(&quot;pbd.shelve&quot;)</span>
<span class="sd">    </span>
<span class="sd">    id = pbs.getid(r)</span>
<span class="sd">    </span>
<span class="sd">    db[id] = r </span>
<span class="sd">    </span>
<span class="sd">    pprint (db[id])</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    print(&quot;Hosts:&quot;, pbs.servers())</span>
<span class="sd">    print (&quot;Queues&quot;, pbs.queues(&quot;delta&quot;))</span>
<span class="sd">    print (&quot;Queues&quot;, pbs.queues(&quot;karst&quot;))</span>

<span class="sd">    print(pbs.qstat(host))</span>
<span class="sd">    print(pbs.qstat(host, user=&quot;*&quot;))</span>
<span class="sd">    print(pbs.qstat(host, user=&quot;*&quot;, format=&quot;xml&quot;))</span>
<span class="sd">    print(json.dumps(pbs.qstat(host, user=&quot;*&quot;, format=&quot;dict&quot;), indent=4))</span>
<span class="sd">    print(pbs.username(&quot;bigred&quot;))</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c"># pbs.db.update(host=&quot;india&quot;)</span>
    <span class="c"># attributes = [&quot;cm_jobid&quot;, &quot;cm_host&quot;, &quot;cm_user&quot;, &quot;Job_Name&quot;, &quot;job_state&quot;, &quot;exit_status&quot;]</span>
    <span class="c"># banner(&quot;LIST&quot;)</span>
    <span class="c"># print(pbs.db.list(attributes, output=&quot;csv&quot;))</span>

    <span class="c"># pprint (pbs.data)</span>
    <span class="c"># banner(&quot;table&quot;)</span>
    <span class="c"># print(pbs.db.list(attributes, output=&quot;table&quot;))</span>
    <span class="c"># banner(&quot;yaml&quot;)</span>
    <span class="c"># print(pbs.db.list(attributes, output=&quot;yaml&quot;))</span>
    <span class="c"># banner(&quot;dict&quot;)</span>
    <span class="c"># print(pbs.db.list(attributes, output=&quot;dict&quot;))</span>

    <span class="c"># print(print_format_dict(pbs.db.data, header=None, kind=&#39;table&#39;))</span>

    <span class="c"># print(pbs.db.list(attributes, output=&quot;dict&quot;))</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, myCloudmesh.org/learning.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'Learning',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>